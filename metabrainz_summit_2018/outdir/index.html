<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>MetaBrainz Summit 2018 - Resources</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="mb2018.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div class="header"><blockquote><img src="images/background.png"></img></blockquote></div><div id="impress" data-transition-duration="800"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="86.39999999999999" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="metabrainz-summit-2018">MetaBrainz Summit 2018</h1><h2 id="our-infrastructure">Our infrastructure</h2></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="68.82352941176465" data-scale="1" data-x="309" data-y="1655" data-z="0"><h1 id="number-of-servers">Number of servers</h1><ul><li>Hetzner: 20 physical machines</li><li>Hetzner Cloud: 8 virtual machines</li><li>Google Cloud: 12 active instances</li><li>Total: <strong>40 servers</strong></li></ul><div class="notes"><p>TODO</p></div></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="47.64705882352948" data-scale="1" data-x="1196" data-y="3087" data-z="0"><h1 id="memory-storage-processing-power">Memory, storage, processing power</h1><ul><li>1.5 Terabytes of RAM</li><li>18 Terabytes of storage</li><li>1.7M Bogomips on 240 CPU cores</li></ul><div class="notes"><p>TODO.</p></div></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="26.47058823529401" data-scale="1" data-x="2540" data-y="4103" data-z="0"><h1 id="network-traffic">Network traffic</h1><ul><li><em>180 Terabytes</em> served this year</li><li><em>~50 mbits/s</em> out, <em>20 mbits/s</em> in</li><li><em>120</em> mbits/s out before, due to QNAP</li></ul></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="5.294117647058777" data-scale="1" data-x="4160" data-y="4564" data-z="0"><h1 id="latency">Latency</h1><img src="images/ping_latency_world.png" height="600px"></img><div class="notes"><p>Ping to kiki.mb.o from different parts of the World</p></div></div><div class="step step-level-1" step="5" id="mbs1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-15.882352941176428" data-scale="1" data-x="5838" data-y="4408" data-z="0"><h1 id="musicbrainz-services-i">MusicBrainz Services I</h1><p>Number of queries served this year</p><p><strong>11 Billions</strong> of 200s answers</p></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-37.05882352941173" data-scale="1" data-x="7345" data-y="3657" data-z="0"><h1 id="musicbrainz-services-ii">MusicBrainz Services II</h1><ul><li>Incoming Requests: <em>850 req/s</em></li><li>Handled by upstreams: <strong>280 req/s</strong></li></ul></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-58.2352941176471" data-scale="1" data-x="8480" data-y="2412" data-z="0"><h1 id="musicbrainz-services-iii">MusicBrainz Services III</h1><ul><li>MB Website mean response time: <strong>240 ms</strong></li><li>WS mean response time a bit worse: 20 to 30ms</li></ul></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-79.41176470588232" data-scale="1" data-x="9089" data-y="842" data-z="0"><h1 id="solr">SOLR</h1><ul><li>6 servers on Hetzner Cloud</li><li><em>180 req/s</em> during peak time</li><li>Worst mean response time: <em>125 ms</em></li><li>Best mean response time: 75 ms</li><li>full redundancy, automatic fail over</li></ul></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-100.58823529411764" data-scale="1" data-x="9089" data-y="-842" data-z="0"><h1 id="hetzner-cloud-i">Hetzner Cloud I</h1><ul><li>Hosting adds 10ms latency on WS (more hops)</li><li>VM CPU performance isn't guaranteed</li></ul></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-121.76470588235301" data-scale="1" data-x="8480" data-y="-2412" data-z="0"><h1 id="hetzner-cloud-ii">Hetzner Cloud II</h1><ul><li>low cost: 99&#x20AC; / month for 6 VMs (SOLR)</li><li>convenient</li><li>not 100% on, due to Hetzner maintenance ops</li></ul></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-142.94117647058823" data-scale="1" data-x="7345" data-y="-3657" data-z="0"><h1 id="docker-i">Docker I</h1><ul><li><em>170</em> containers running</li><li>our setup is not standard enough</li><li>kubernetes is still very far</li></ul></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-164.11764705882356" data-scale="1" data-x="5838" data-y="-4408" data-z="0"><h1 id="docker-ii">Docker II</h1><ul><li>some issues related to git2consul</li><li>docker-server-configs critical</li></ul></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-185.29411764705878" data-scale="1" data-x="4160" data-y="-4564" data-z="0"><h1 id="docker-iii">Docker III</h1><ul><li>volumes management is a pain</li><li>some containers are critical</li><li>restarting docker / rebooting machine not possible</li></ul></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-206.47058823529403" data-scale="1" data-x="2540" data-y="-4103" data-z="0"><h1 id="stability">Stability</h1><ul><li>99.9% availability of core services</li><li>limited failure impact</li><li>crappy cpu fans (6 were replaced)</li><li>still too many <strong>SPoFs</strong></li></ul></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-227.64705882352945" data-scale="1" data-x="1196" data-y="-3087" data-z="0"><h1 id="soon">Soon...</h1><ul><li>work at reducing SPoFs</li><li>improved database backups using Barman</li><li>moving more services to VMs</li><li>upgrading to 18.04</li><li>upgrading docker + consul</li></ul></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="-248.82352941176464" data-scale="1" data-x="309" data-y="-1655" data-z="0"><h1 id="thanks">Thanks !</h1><p>Made with <a href="https://github.com/regebro/hovercraft">Hovercraft</a> and Critical</p></div></div><div class="footer"><p>"System &amp; Network Resources", Laurent Monin, MetaBrainz Summit 2018</p></div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>G</th><td>Go to slide number</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>